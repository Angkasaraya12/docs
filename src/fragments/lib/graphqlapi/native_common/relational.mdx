import ios0 from "/src/fragments/lib/graphqlapi/ios/relational/callout.mdx";

<Fragments fragments={{ ios: ios0 }} />

import android0 from '/src/fragments/lib/graphqlapi/android/relational/callout.mdx';

<Fragments fragments={{ android: android0 }} />

API (GraphQL) has the capability to handle relationships between Models, such as _has one_, _has many_, _belongs to_. In GraphQL this is done with the `@hasOne`, `@hasMany` and `@index` directives as defined in the [GraphQL Transformer documentation](/cli/graphql/data-modeling).

By default, API (GraphQL) requests generate a selection set with a depth of 0. Connected relationship models are not returned in the initial request, but can be lazily loaded as needed (additional API request). We provide mechanisms to customize the selection set, which allows connected relationships to be eagerly loaded on the initial request.

import android1 from '/src/fragments/lib/graphqlapi/android/relational/prerequisites.mdx';

<Fragments fragments={{ android: android1 }} />

import android2 from '/src/fragments/lib/graphqlapi/android/relational/migration.mdx';

<Fragments fragments={{ android: android2 }} />

## Updated schema

import ios1 from "/src/fragments/lib/graphqlapi/ios/relational/updated-schema.mdx";

<Fragments fragments={{ ios: ios1 }} />

import android3 from '/src/fragments/lib/graphqlapi/android/relational/updated-schema.mdx';

<Fragments fragments={{ android: android3 }} />

import android4 from '/src/fragments/lib/graphqlapi/android/relational/codegen-reference-types.mdx';

<Fragments fragments={{ android: android4 }} />

## Creating relations

In order to create connected models, you will create an instance of the model you wish to connect and pass it to `Amplify.API.mutate`:

import ios5 from "/src/fragments/lib/graphqlapi/ios/relational/save-snippet.mdx";

<Fragments fragments={{ ios: ios5 }} />

import android6 from '/src/fragments/lib/graphqlapi/android/relational/save-snippet.mdx';

<Fragments fragments={{ android: android6 }} />

## Querying relations

import ios9 from "/src/fragments/lib/graphqlapi/ios/relational/query-snippet.mdx";

<Fragments fragments={{ ios: ios9 }} />

import android10 from '/src/fragments/lib/graphqlapi/android/relational/query-snippet.mdx';

<Fragments fragments={{ android: android10 }} />

## Deleting relations

When you delete a parent object in a one-to-many relationship, the children will not be removed. Delete the children before deleting the parent to ensure there are no orphaned data.

## Many-to-many relationships

For many-to-many relationships, you can use the `@manyToMany` directive and specify a `relationName`. Under the hood, Amplify creates a join table and a one-to-many relationship from both models.

<Callout warning>

Join table records must be deleted prior to deleting the associated records. For example, for a many-to-many relationship between Posts and Tags, delete the PostTags join record prior to deleting a Post or Tag.

</Callout>

```graphql
type Post @model {
  id: ID!
  title: String!
  rating: Int
  editors: [User] @manyToMany(relationName: "PostEditor")
}

type User @model {
  id: ID!
  username: String!
  posts: [Post] @manyToMany(relationName: "PostEditor")
}
```

import ios17 from '/src/fragments/lib/graphqlapi/ios/relational/save-many-snippet.mdx';

<Fragments fragments={{ ios: ios17 }} />

import android18 from '/src/fragments/lib/graphqlapi/android/relational/save-many-snippet.mdx';

<Fragments fragments={{ android: android18 }} />

## Customizing query depth (Custom Selection Sets)

You can perform a nested query, through one network request, by specifying which connected model(s) to include. This is achieved by adding using the optional `includes` parameter for a GraphQL request.

Query for the Comment and the Post that it belongs to:

import ios19 from '/src/fragments/lib/graphqlapi/ios/relational/customizing-query-depth-comment-post.mdx';

<Fragments fragments={{ ios: ios19 }} />

import android20 from '/src/fragments/lib/graphqlapi/android/relational/customizing-query-depth-comment-post.mdx';

<Fragments fragments={{ android: android20 }} />

Query for the Post and the first page of comments for the post: 

import ios21 from '/src/fragments/lib/graphqlapi/ios/relational/customizing-query-depth-post-comments.mdx';

<Fragments fragments={{ ios: ios21 }} />

import android22 from '/src/fragments/lib/graphqlapi/android/relational/customizing-query-depth-post-comments.mdx';

<Fragments fragments={{ android: android22 }} />

import android23 from '/src/fragments/lib/graphqlapi/android/relational/complex-query-depth.mdx';

<Fragments fragments={{ android: android23 }} />
