export const meta = {
  title: 'Quickstart',
  description: 'Get started with AWS Amplify (Gen 2).'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };
}

This Quickstart guide will walk you through how to build a Task list application with TypeScript, Next.js, and React. If you're new to these technologies, we recommend you go through the official [React](https://react.dev/learn/tutorial-tic-tac-toe), [Next.js](https://nextjs.org/docs/getting-started/installation), and [TypeScript](https://www.typescriptlang.org/docs/handbook/typescript-from-scratch.html) tutorials first.

## Prerequisites

Before you get started, make sure you have the following installed:

- [Node.js](https://nodejs.org/) v18.x or later
- [npm](https://www.npmjs.com/) v9 or later
- [git](https://git-scm.com/) v2.14.1 or later
- You will also need to [create an AWS Account](https://portal.aws.amazon.com/billing/signup). Note that AWS Amplify is part of the [AWS Free Tier](https://aws.amazon.com/amplify/pricing/).
- Configure your AWS account to use with Amplify [instructions](/gen2/start/account-setup/).

## Create a project

First, you'll need to create a new Next.js app. The following command will create a Next.js app in a directory called `next-amplify-gen2`.

```bash
npm create next-app@14 -- next-amplify-gen2 --typescript --eslint --no-app --no-src-dir --no-tailwind --import-alias '@/*'
cd next-amplify-gen2
```

The easiest way to get started with AWS Amplify is through npm with `create-amplify`

```bash
npm create amplify@latest
? Where should we create your project? (.) # press enter
```

Running this command will scaffold a lightweight Amplify project in your current project with the following files:

```text
â”œâ”€â”€ amplify/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ backend.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ node_modules/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## Start local dev server

Let's start a local dev server for your app development. For the frontend, run `npm run dev` that will spin up a `localhost` dev server with the default Next.js template.

```bash
npm run dev
```

For the backend, we are going to start a cloud sandbox environment. Amplify gives every developer a personal cloud sandbox environment that provide isolated development spaces for to rapidly build, test, and iterate. When you're working with a team, each developer will have their own personal cloud sandbox.

```bash
npx amplify sandbox
```

> Do not use sandbox environments in production.

## Build a backend

### Add data

Each of the `resource.ts` files is where you _define_ the corresponding backend resource. If you open up the `/amplify/data/resource.ts` file in your text editor, you'll see some generated code already there:

```ts {6} showLineNumbers
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    name: a.string(),
    description: a.string()
  })
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({ schema });
```

<Accordion title="What is a schema?">
  The schema generated by Amplify is for a Todo app. A schema is a blueprint for
  how our app's data will be laid out. Within the schema, we'll define models
  which will correspond to database table - `Todo` in the above code. Finally,
  we'll define fields which are attributes each data instance will have - in the
  generated code the fields are `name` and `description`. Each field will have a
  type attached to it, in the above examples we are stating that both `name` and
  `description` are strings.
</Accordion>

Let's make a quick change to our data model and add a `done` field which will be a `boolean` which can be set to `true` or `false` depending if our Todo list item is complete. Let's also add a priority field, which will be an enum. This field type will allow for just a few options to be stored - low, medium, or high.

```diff
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
+    done: a.boolean(),
+    priority: a.enum(['low', 'medium', 'high'])
  })
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema
});
```

Once you save your change to the data model, your changes will be deployed in seconds within your cloud sandbox.

The definitions are imported and set in the `backend` file. We won't need to change anything in this file right now, but you can see its contents which define a backend with our data and auth configurations from their respective files.

```ts title="amplify/backend.ts"
import { defineBackend } from '@aws-amplify/backend';
import { auth } from './auth/resource.js';
import { data } from './data/resource.js';

defineBackend({
  auth,
  data
});
```

### Add authentication

Now let's work on our authentication configuration. Similar to the `data/resource.ts` we just worked on, the `auth/resource.ts` file has code to define our authentication configuration. In this case, setting the authentication method to login with email.

```ts title="amplify/auth/resource.ts"
import { defineAuth } from '@aws-amplify/backend';

export const auth = defineAuth({
  loginWith: {
    email: true
  }
});
```

Let's customize this a bit for our app. We can add a subject line to the email that our users get when they are asked to verify their account by adding an object to define more properties about our email authentication.

```ts
import { defineAuth } from '@aws-amplify/backend-auth';

export const auth = defineAuth({
  loginWith: {
    email: {
      verificationEmailSubject: 'Welcome ðŸ‘‹ verify your email!'
    }
  }
});
```

## Build UI

Let's add UI that connects to the backend data and auth resources.

### Add a login form

First, install the Amplify UI component library:

```bash
npm add @aws-amplify/ui-react
```

Next, in your app's `pages/_app.ts` add the following imports and wrap your App in the `withAuthenticator` function:

```ts title="pages/_app.ts"
import { withAuthenticator } from '@aws-amplify/ui-react';
import { Amplify } from 'aws-amplify';
import config from '@/amplifyconfiguration.json';
import '@aws-amplify/ui-react/styles.css';
import '@/styles/globals.css';
import type { AppProps } from 'next/app';

// configure the Amplify client library with the configuration generated by `amplify sandbox`
Amplify.configure(config);

function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}

export default withAuthenticator(App);
```

Run your application with `npm run dev` and navigate to `http://localhost:3000`. You should now see the authenticator, which is already configured and ready for your first sign-up! Create a new user account, confirm the account via email, then sign in.

### View list of To Do items

Now, let's display data on our app's frontend. Modify your app's home page file, `pages/index.tsx`, with the following contents:

```ts title="pages/index.tsx"
import { useState, useEffect } from 'react';
import { generateClient } from 'aws-amplify/data';
import { Schema } from '@/amplify/data/resource';

// generate your data client using the Schema from your backend
const client = generateClient<Schema>();

export default function HomePage() {
  const [todos, setTodos] = useState<Schema['Todo'][]>([]);

  async function listTodos() {
    // fetch all todos
    const { data } = await client.models.Todo.list();
    setTodos(data);
  }

  useEffect(() => {
    listTodos();
  }, []);

  return (
    <main>
      <h1>Hello, Amplify ðŸ‘‹</h1>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>{todo.name}</li>
        ))}
      </ul>
    </main>
  );
}
```

Once you save the file and navigate back to `http://localhost:3000` you should see an empty list of To do.

### Create a new To Do item

Let's update the return of the above component to also have a button for creating a new to do list item, prompting the user to add the title and description. In a production app you would want to create a full form and run the create method on form submission.

```ts title="pages/index.tsx"
  return (
    <main>
      <h1>Hello, Amplify ðŸ‘‹</h1>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>{todo.name}</li>
        ))}
        <button onClick={() => {
          // create a new Todo with the following attributes
          const { errors, data: newTodo } = await client.models.Todo.create({
            // prompt the user to enter the title
            title: window.prompt("title"),
            description: window.prompt("description"),
            done: false,
            priority: 'medium'
          })
        }}>Create </button>
      </ul>
    </main>
  );
}
```

### Terminate dev server

Go to `localhost` in the browser to make sure you can now login, create, and list todos. You can end your development session by shutting down the frontend dev server and cloud sandbox. The sandbox prompts you to delete your backend resources - while you can retain your backend, we recommend deleting all resources so you can start clean again next time.

## Deploy and host fullstack branch

Now that your app is working, let's deploy it to a shared fullstack branch so the project is shareable with your team. Amplify offers a fully managed hosting service with CI/CD built-in, making it easy to set up production and staging environments with Git branches. In Gen 2, every Git branch in your repository maps 1:1 to a fullstack branch in Amplify.

### Create a remote git repository

If you already have your project remotely hosted in a Git repository, you can skip this step. Otherwise, navigate to your preferred Git provider, and add your project to a new repository. Amplify supports [GitHub](https://docs.github.com/en/get-started/quickstart/create-a-repo), [AWS CodeCommit](https://docs.aws.amazon.com/codecommit/latest/userguide/how-to-create-repository.html), [GitLab](https://docs.gitlab.com/ee/user/project/index.html) and [BitBucket](https://support.atlassian.com/bitbucket-cloud/docs/create-a-git-repository/).

### Connect branch in Amplify console

1. To get started with Gen 2, log in to [AWS console](console.aws.amazon.com/console/home?#amplify) and navigate to your preferred region. (the Amplify console is available in [19 regions](https://docs.aws.amazon.com/general/latest/gr/amplify.html#amplify_region)).

2. Choose the new _Build an app_ Gen 2 option. If you've never created apps with Amplify before, choose _Build an app_ from the purple banner (top screenshot). If you have Amplify apps, you can find the option under _New app > Build an app (Gen 2)_.

![gen2](/images/gen2/getting-started/console1.png)

3. In the Git provider screen choose _Option 2: Start with an existing app_. Connect the repository you just deployed and pick a branch. Review all of your settings to ensure everything is set up correctly. Choose Save and deploy to deploy your web app to the AWS global content delivery network (CDN).

<video autoPlay={true} muted={true} loop={true} width="100%">
  <source src="/images/gen2/getting-started/console1.mp4" />
</video>

4. ðŸŽ‰ That's it! Your app backend and frontend will now take ~5 minutes to build and deploy.

### Manage fullstack branch

The new Amplify console gives you a central place to manage your branches, hosting settings, CI/CD builds, and backend resources. Even though customers can access backend resources directly from AWS service consoles, the Amplify console offers built-in user and data administration.
